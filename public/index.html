<!DOCTYPE html>
<html ng-app="fdCalculator">
<head>
    <title>FD Calculator</title>
    <link rel="stylesheet" type="text/css" href="lib/normalize.css/normalize.css">

</head>
<body>

  <h1>Functional Dependency Calculator</h1>

  <div class="schema" ng-controller="FdController">
    <h2>
      schema(
      <span class="attribute" ng-repeat="attr in breakUpFD(schema) track by $index">
        {{attr}}
      </span>
      )

    </h2>
    <input type="text" ng-model="schema"/>
  </div>

  <div class="inputs" ng-controller="InputController">

    <ul ng-repeat="fd in FDs"
        ng-controller="FdController"
        id="fd-{{fd.id}}">
      <li class="fd-values">
        <h2>
          {{fd.id}}:
          <span class="independent" ng-repeat="fdLabel in breakUpFD(independent, fd.id) track by $index">
            {{fdLabel}}
          </span>
          &rightarrow;
          <span class="dependent" ng-repeat="fdLabel in breakUpFD(dependent, fd.id) track by $index">
            {{fdLabel}}
          </span>
        </h2>
      </li>
      <li class="fd-inputs">
        <input
          type="text"
          ng-model="independent"
          ng-keyup="record(fd.id)"
          value="{{independent}}"
        />
        &rightarrow;
        <input
          type="text"
          ng-model="dependent"
          ng-keyup="record(fd.id)"
        />
        <button ng-click="removeFD(fd.id)">Remove</button>
      </li>
    </ul>

    <button ng-click="addNewFD()">Add</button>
    <button ng-click="calculateCanonical()">Calculate</button>

    <pre>{{FDs}}</pre>
  </div>

  <!--<script type="text/javascript" data-main="js/main" src="lib/requirejs/require.js"></script>-->

  <script type="text/javascript" src="lib/angular/angular.min.js"></script>
  <script type="text/javascript">
    var fdCalculator = angular.module('fdCalculator',[]);

    fdCalculator.controller('InputController', [
      '$scope',
      function InputController ($scope) {
        $scope.uniqueID = 0;

        $scope.FDs = [];

        $scope.getFD = function (id, callback) {
          for (var i = 0; i < $scope.FDs.length; i++) {
            if ($scope.FDs[i].id == id) {
              if (typeof callback == "function") {
                callback(i, $scope.FDs[i]);
              }
              return $scope.FDs[i];
            }
          }
        };
        $scope.addNewFD = function () {
          $scope.FDs.push({
            id: $scope.uniqueID++,
            dependent: [],
            independent: []
          });
        };
        $scope.removeFD = function (id) {
          $scope.getFD(id, function (idx) {
            $scope.FDs.splice(idx, 1);
            document.getElementById('fd-' + id).remove();
          });
        }

        $scope.addNewFD();

      }
    ]);

    fdCalculator.controller('FdController', [
      '$scope',
      function InputController ($scope) {
        var fdSplit = /\,\s*/;
        $scope.breakUpFD = function (fds) {
          return fds? fds.split(fdSplit) : [];
        };
        $scope.record = function (id) {
          $scope.getFD(id).dependent = $scope.breakUpFD($scope.dependent);
          $scope.getFD(id).independent = $scope.breakUpFD($scope.independent);
        };
      }
    ]);

  </script>
</body>
</html>
